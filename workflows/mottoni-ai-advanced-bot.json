{
  "name": "MOTTONI AI Advanced Bot - Hafızalı Uzman",
  "description": "Hafızalı, öğrenen, kategorize eden ve bilgi bankası entegreli MOTTONI uzmanı AI bot",
  "nodes": [
    {
      "parameters": {
        "updates": ["message"],
        "additionalFields": {}
      },
      "id": "telegram-trigger",
      "name": "Telegram Bot Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "position": [240, 300],
      "webhookId": "mottoni-ai-advanced-bot",
      "credentials": {
        "telegramApi": {
          "id": "telegram-credential",
          "name": "Telegram Bot API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// MOTTONI Bilgi Bankası Yönetimi\nconst userMessage = $input.item.json.message.text;\nconst userId = $input.item.json.message.from.id;\nconst userName = $input.item.json.message.from.first_name;\n\n// Resmi Teknik Özellikler (Öncelikli Kaynak)\nconst technicalSpecs = {\n  \"50x70cm\": {\n    \"hiz\": \"12.000 sayfa/saat\",\n    \"folyo_genisligi\": \"100-750mm\",\n    \"guc\": \"9kw\",\n    \"agirlik\": \"500kg\",\n    \"boyutlar\": \"1.800x900x1.000mm\"\n  },\n  \"70x100cm\": {\n    \"hiz\": \"12.000 sayfa/saat\",\n    \"folyo_genisligi\": \"100-1.020mm\",\n    \"guc\": \"11kw\",\n    \"agirlik\": \"650kg\",\n    \"boyutlar\": \"2.290x900x1.200mm\"\n  },\n  \"100x140cm\": {\n    \"hiz\": \"12.000 sayfa/saat\",\n    \"folyo_genisligi\": \"100-1.200mm\",\n    \"guc\": \"15kw\",\n    \"agirlik\": \"1.000kg\",\n    \"boyutlar\": \"2.800x900x1.400mm\"\n  }\n};\n\n// Maliyet Analizi (Resmi Veriler)\nconst costAnalysis = {\n  \"sicak_folyo\": \"1.155€\",\n  \"soguk_folyo\": \"712€\",\n  \"tasarruf_orani\": \"%62\",\n  \"aylik_tasarruf_100k\": \"5.537€/ay\",\n  \"yillik_tasarruf_100k\": \"66.444€/yıl\"\n};\n\n// Malzeme Maliyetleri\nconst materialCosts = {\n  \"yapiskan\": \"25€/kg (ZELLER-GMELIN)\",\n  \"folyo\": \"0,17-0,21€/m²\",\n  \"battaniye\": \"~250€ (70x100cm)\"\n};\n\n// Kullanım Alanları\nconst usageAreas = [\n  \"Ambalaj (kozmetik, gıda, ilaç, lüks)\",\n  \"Etiketler (ürün, şarap, sağlık, endüstriyel)\",\n  \"Kataloglar ve dergiler\",\n  \"Kitap kapakları\",\n  \"Güvenlik ürünleri\",\n  \"Promosyon malzemeleri\"\n];\n\n// Soru kategorisini belirle\nlet category = \"Genel\";\nif (userMessage.toLowerCase().includes('teknik') || userMessage.toLowerCase().includes('özellik') || userMessage.toLowerCase().includes('hız') || userMessage.toLowerCase().includes('boyut')) {\n  category = \"Teknik Özellikler\";\n} else if (userMessage.toLowerCase().includes('maliyet') || userMessage.toLowerCase().includes('fiyat') || userMessage.toLowerCase().includes('tasarruf')) {\n  category = \"Maliyet Analizi\";\n} else if (userMessage.toLowerCase().includes('kurulum') || userMessage.toLowerCase().includes('eğitim') || userMessage.toLowerCase().includes('montaj')) {\n  category = \"Kurulum/Eğitim\";\n} else if (userMessage.toLowerCase().includes('satış') || userMessage.toLowerCase().includes('teklif') || userMessage.toLowerCase().includes('fiyat')) {\n  category = \"Satış/Teklif\";\n} else if (userMessage.toLowerCase().includes('sorun') || userMessage.toLowerCase().includes('problem') || userMessage.toLowerCase().includes('hata')) {\n  category = \"Sorun Giderme\";\n} else if (userMessage.toLowerCase().includes('avantaj') || userMessage.toLowerCase().includes('rekabet') || userMessage.toLowerCase().includes('pazarlama')) {\n  category = \"Pazarlama/Rekabet\";\n}\n\n// Bilgi bankası içeriğini hazırla\nconst knowledgeBase = {\n  technicalSpecs,\n  costAnalysis,\n  materialCosts,\n  usageAreas,\n  category,\n  userInfo: {\n    id: userId,\n    name: userName,\n    message: userMessage,\n    timestamp: new Date().toISOString()\n  }\n};\n\nreturn {\n  json: {\n    ...knowledgeBase,\n    originalMessage: $input.item.json\n  }\n};"
      },
      "id": "bilgi-bankasi",
      "name": "Bilgi Bankası Yönetimi",
      "type": "n8n-nodes-base.code",
      "position": [460, 300]
    },
    {
      "parameters": {
        "resource": "text",
        "operation": "message",
        "model": "gpt-4",
        "messages": {
          "messageType": "multipleMessages",
          "messages": [
            {
              "role": "system",
              "content": "Sen MOTTONI Cold Foil makineleri konusunda uzman bir AI asistanısın. Gerçek bir üretici müdürü, operatör ve satış temsilcisi gibi davranıyorsun.\n\nKİMLİĞİN:\n- MOTTONI şirketinin deneyimli teknik uzmanı\n- 15+ yıl matbaa ve soğuk folyo deneyimi\n- Müşteri odaklı, profesyonel ve samimi\n- Türkçe ana dil, İngilizce, Arapça, Rusça konuşabilir\n\nÖNCELİKLİ BİLGİ KAYNAKLARIN:\n1. MOTTONI® GEEN 2ND GENERATION resmi teknik özellikler\n2. %62 maliyet avantajı resmi analizi\n3. Katalog pazarlama içerikleri\n4. Web sitesi resmi bilgileri\n\nTEKNİK VERİLER (GEEN 2ND GENERATION):\n{{ $json.technicalSpecs | JSON.stringify() }}\n\nMALİYET ANALİZİ:\n{{ $json.costAnalysis | JSON.stringify() }}\n\nMALZEME MALİYETLERİ:\n{{ $json.materialCosts | JSON.stringify() }}\n\nKULLANIM ALANLARI:\n{{ $json.usageAreas | JSON.stringify() }}\n\nSORU KATEGORİSİ: {{ $json.category }}\n\nCEVAP TARZI:\n- Kısa, net ve teknik\n- Örneklerle destekle\n- Maliyet avantajlarını vurgula\n- Müşteri ihtiyacına odaklan\n- GEEN 2ND GENERATION özelliklerini öne çıkar\n- %62 tasarruf rakamını kullan\n- 12.000 sayfa/saat hızı vurgula"
            },
            {
              "role": "user",
              "content": "Kullanıcı: {{ $json.userInfo.name }}\nKullanıcı ID: {{ $json.userInfo.id }}\nSoru Kategorisi: {{ $json.category }}\nSoru: {{ $json.userInfo.message }}\nTarih: {{ $json.userInfo.timestamp }}"
            }
          ]
        }
      },
      "id": "mottoni-ai-uzman",
      "name": "MOTTONI AI Uzman",
      "type": "n8n-nodes-base.openAi",
      "position": [680, 300],
      "credentials": {
        "openAiApi": {
          "id": "openai-credential",
          "name": "OpenAI API"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": "{{ $env.GOOGLE_SHEETS_MEMORY_ID }}",
        "sheetName": "SORU_CEVAP_HAFIZA",
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Tarih": "={{ $('Bilgi Bankası Yönetimi').item.json.userInfo.timestamp }}",
            "KullaniciID": "={{ $('Bilgi Bankası Yönetimi').item.json.userInfo.id }}",
            "KullaniciAdi": "={{ $('Bilgi Bankası Yönetimi').item.json.userInfo.name }}",
            "Soru": "={{ $('Bilgi Bankası Yönetimi').item.json.userInfo.message }}",
            "AICevap": "={{ $('MOTTONI AI Uzman').item.json.choices[0].message.content }}",
            "Kategori": "={{ $('Bilgi Bankası Yönetimi').item.json.category }}",
            "Durum": "Cevaplandı"
          }
        }
      },
      "id": "hafiza-kayit",
      "name": "Hafıza Kayıt",
      "type": "n8n-nodes-base.googleSheets",
      "position": [900, 300],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "google-sheets-credential",
          "name": "Google Sheets API"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Bilgi Bankası Yönetimi').item.json.originalMessage.message.chat.id }}",
        "text": "={{ $('MOTTONI AI Uzman').item.json.choices[0].message.content }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "id": "telegram-cevap",
      "name": "Telegram Cevap",
      "type": "n8n-nodes-base.telegram",
      "position": [1120, 300],
      "credentials": {
        "telegramApi": {
          "id": "telegram-credential",
          "name": "Telegram Bot API"
        }
      }
    },
    {
      "parameters": {
        "resource": "text",
        "operation": "message",
        "model": "gpt-4",
        "messages": {
          "messageType": "multipleMessages",
          "messages": [
            {
              "role": "system",
              "content": "Sen MOTTONI AI'nın öğrenme ve kategorileme uzmanısın. Gelen soru-cevap çiftlerini analiz et ve:\n\n1. Kategoriyi doğrula (Teknik, Maliyet, Kurulum, Satış, Sorun Giderme, Pazarlama)\n2. Yeni öğrenilen bilgileri çıkar\n3. Gelecek sorular için öneriler üret\n4. Bilgi güncellemesi gerekip gerekmediğini değerlendir\n5. Müşteri profilini analiz et\n\nÇıktı formatı:\nKategori: [kategori]\nYeni Bilgi: [öğrenilen bilgi]\nÖneriler: [gelecek için öneriler]\nGüncelleme: [gerekli/değil]\nMüşteri Profili: [analiz]"
            },
            {
              "role": "user",
              "content": "Soru: {{ $('Bilgi Bankası Yönetimi').item.json.userInfo.message }}\nCevap: {{ $('MOTTONI AI Uzman').item.json.choices[0].message.content }}\nKullanıcı: {{ $('Bilgi Bankası Yönetimi').item.json.userInfo.name }}\nKategori: {{ $('Bilgi Bankası Yönetimi').item.json.category }}"
            }
          ]
        }
      },
      "id": "ogrenme-analiz",
      "name": "Öğrenme Analizi",
      "type": "n8n-nodes-base.openAi",
      "position": [900, 480],
      "credentials": {
        "openAiApi": {
          "id": "openai-credential",
          "name": "OpenAI API"
        }
      }
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": "{{ $env.GOOGLE_SHEETS_LEARNING_ID }}",
        "sheetName": "OGRENME_ANALIZI",
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Tarih": "={{ $('Bilgi Bankası Yönetimi').item.json.userInfo.timestamp }}",
            "KullaniciID": "={{ $('Bilgi Bankası Yönetimi').item.json.userInfo.id }}",
            "KullaniciAdi": "={{ $('Bilgi Bankası Yönetimi').item.json.userInfo.name }}",
            "SoruKategorisi": "={{ $('Bilgi Bankası Yönetimi').item.json.category }}",
            "YeniBilgi": "={{ $('Öğrenme Analizi').item.json.choices[0].message.content.split('Yeni Bilgi:')[1]?.split('\\n')[0]?.trim() || 'Yok' }}",
            "Oneriler": "={{ $('Öğrenme Analizi').item.json.choices[0].message.content.split('Öneriler:')[1]?.split('\\n')[0]?.trim() || 'Yok' }}",
            "GuncellemeGerekli": "={{ $('Öğrenme Analizi').item.json.choices[0].message.content.includes('Güncelleme: gerekli') ? 'Evet' : 'Hayır' }}",
            "MusteriProfili": "={{ $('Öğrenme Analizi').item.json.choices[0].message.content.split('Müşteri Profili:')[1]?.split('\\n')[0]?.trim() || 'Belirsiz' }}",
            "TamAnaliz": "={{ $('Öğrenme Analizi').item.json.choices[0].message.content }}"
          }
        }
      },
      "id": "ogrenme-kayit",
      "name": "Öğrenme Kaydı",
      "type": "n8n-nodes-base.googleSheets",
      "position": [1120, 480],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "google-sheets-credential",
          "name": "Google Sheets API"
        }
      }
    }
  ],
  "connections": {
    "Telegram Bot Trigger": {
      "main": [
        [
          {
            "node": "Bilgi Bankası Yönetimi",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Bilgi Bankası Yönetimi": {
      "main": [
        [
          {
            "node": "MOTTONI AI Uzman",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MOTTONI AI Uzman": {
      "main": [
        [
          {
            "node": "Hafıza Kayıt",
            "type": "main",
            "index": 0
          },
          {
            "node": "Öğrenme Analizi",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Hafıza Kayıt": {
      "main": [
        [
          {
            "node": "Telegram Cevap",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Öğrenme Analizi": {
      "main": [
        [
          {
            "node": "Öğrenme Kaydı",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}